<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Voice Book</title>
</head>
<body>

<h1>Voice Book v0.3</h1>
<div>
    <button onclick="send()">Send</button>
    <button id="download" onclick="download()">Not Ready</button>
</div>
<div>
    <textarea id="input" cols="100" rows="30">
        Привет Мир!
        Привет Мир два!
        Привет Мир три!
        Привет Мир четыре!
        Привет Мир пять!
    </textarea>
</div>

<script>
    function poll() {
        setTimeout(() => {
            fetch("/api/generateVoiceBook/progress/" + processId)
                .then(res => res.json())
                .then(res => {
                    if (res.status === "ready") {
                        document.getElementById("download").innerText = "Ready to download";
                    } else if (res.status === "notExist") {
                        document.getElementById("download").innerText = res.status;
                    } else if (res.status === "error") {
                        document.getElementById("download").innerText = res.status;
                    } else {
                        document.getElementById("download").innerText = res.status;
                        poll();
                    }
                })
                .catch(cause => {
                    console.error(cause);
                    alert("Error");
                });
        }, 5000);
    }


    let processId;
    window.send = function () {
        processId = null;
        console.log("sending text...");
        const text = document.getElementById("input").value;
        const data = {text};
        fetch("/api/generateVoiceBook", {
            method: "POST",
            body: JSON.stringify(data),
            headers: {"Content-Type": "application/json; charset=utf-8"}
        })
            .then(res => res.json())
            .then(res => {
                processId = res.processId;
                poll();
            })
            .catch(cause => {
                console.error(cause);
                alert("Error");
            });
    };

    window.download = function () {
        window.location.href = window.location.origin + "/api/generateVoiceBook/" + processId;
    }
</script>

</body>
</html>
