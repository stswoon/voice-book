<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Voice Book</title>
</head>
<body>

<h1>Voice Book v0.7</h1>
<div>
    <button onclick="send()">Send</button>
    <button id="download" onclick="download()">Not Ready</button>
</div>
<div>
        <textarea id="input" cols="100" rows="30">
            Привет Мир! Привет Мир два!
        </textarea>
<!--
        <textarea id="input" cols="100" rows="30">
        Привет Мир!
        [{(Привет Мир два!)}]
        '"Привет Мир три!"'
        Привет Мир четыре.
        Hello World 6

        0123456789

Во все большем количестве российских изданий − как печатных, так и онлайновых − появляются объемные материалы особого типа, за которыми в журналистской среде закрепилось название «длинные тексты» (англ. – long forms) или лонгриды (от англ. − long read – материал, предназначенный для длительного прочтения, в отличие от маленькой заметки). Сразу же следует оговориться, что объем материала – хотя и наиболее заметная, но не ключевая характеристика лонгрида. Объемными могут быть и материалы других жанров, поэтому сам по себе большой объем текста вовсе не означает, что перед нами лонгрид. Как будет показано в исследовании, лонгриды отличает также особый подход к выбору темы, требования к качеству собранной информации и способ подачи материала. В исследовании предпринята попытка описать типологические характеристики лонгридов, разобрать особенности их подготовки, а также выявить распространенность лонгридов в современной российской прессе. Еще одной целью исследования является оценка перспектив этого жанра, о котором можно говорить если не как о сложившемся (в принятых на сегодняшний день в научной среде жанровых классификациях лонгрид отсутствует), то как о складывающемся и проникающем во все большее количество изданий.
    </textarea>
 -->
</div>

<script>
    function poll() {
        setTimeout(() => {
            fetch("/api/generateVoiceBook/progress/" + processId)
                .then(res => res.json())
                .then(res => {
                    if (res.status === "ready") {
                        document.getElementById("download").innerText = "Ready to download";
                    } else if (res.status === "notExist") {
                        document.getElementById("download").innerText = res.status;
                    } else if (res.status === "error") {
                        document.getElementById("download").innerText = res.status;
                    } else {
                        document.getElementById("download").innerText = res.status;
                        poll();
                    }
                })
                .catch(cause => {
                    console.error(cause);
                    alert("Error");
                });
        }, 5000);
    }


    let processId;
    window.send = function () {
        processId = null;
        console.log("sending text...");
        const text = document.getElementById("input").value;
        const data = {text};
        fetch("/api/generateVoiceBook", {
            method: "POST",
            body: JSON.stringify(data),
            headers: {"Content-Type": "application/json; charset=utf-8"}
        })
            .then(res => res.json())
            .then(res => {
                processId = res.processId;
                poll();
            })
            .catch(cause => {
                console.error(cause);
                alert("Error");
            });
    };

    window.download = function () {
        window.location.href = window.location.origin + "/api/generateVoiceBook/" + processId;
    }
</script>

</body>
</html>
